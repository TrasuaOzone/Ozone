<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ozone Tea ‚Äì ƒê·∫∑t h√†ng ƒëa m√≥n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      background: #fff7f0;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 24px;
    }
    h1 img {
      height: 40px;
      vertical-align: middle;
      margin-right: 10px;
    }
    label {
      font-weight: bold;
      margin-top: 15px;
      display: block;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }
    button {
      background: #d2691e;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      margin-top: 20px;
      cursor: pointer;
    }
    button:hover {
      background: #a0522d;
    }
    .item-block {
      border: 1px solid #ddd;
      padding: 15px;
      margin-top: 20px;
      border-radius: 8px;
      background: #f9f9f9;
    }
    .item-block h4 {
      margin-bottom: 10px;
    }
    .remove-btn {
      background: #c0392b;
      margin-top: 10px;
    }
    .topping-group {
      margin-top: 10px;
    }
    .topping-list div {
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .topping-list input {
      width: 60px;
    }
    #totalDisplay {
      font-size: 16px;
      font-weight: bold;
      margin-top: 30px;
      text-align: right;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>
      <img src="images/logo.png" alt="Ozone Tea Logo">
      Ozone Tea ‚Äì ƒê·∫∑t h√†ng
    </h1>
    <form id="orderForm">
      <label>T√™n kh√°ch h√†ng:</label>
      <input type="text" name="name" required>

      <label>S·ªë ƒëi·ªán tho·∫°i:</label>
      <input type="tel" name="phone" required>

      <label>H√¨nh th·ª©c nh·∫≠n h√†ng:</label>
      <select name="method" id="method" onchange="calculateTotal()" required>
        <option value="Giao h√†ng t·∫≠n n∆°i">Giao h√†ng t·∫≠n n∆°i</option>
        <option value="Nh·∫≠n t·∫°i qu√°n">Nh·∫≠n t·∫°i qu√°n</option>
      </select>

      <div id="itemsContainer"></div>

      <button type="button" onclick="addItem()">‚ûï Th√™m m√≥n</button>

      <div id="addressBlock">
        <label>ƒê·ªãa ch·ªâ giao h√†ng:</label>
        <textarea name="address" id="address" rows="3" required></textarea>
        <button type="button" onclick="getLocation()">üìç L·∫•y v·ªã tr√≠ hi·ªán t·∫°i</button>
      </div>

      <div id="pickupLocation" style="display:none; margin-top:10px;">
        üìç V·ªã tr√≠ qu√°n: <a href="https://maps.app.goo.gl/naLNEFFzdPMoCo586" target="_blank">Xem tr√™n Google Maps</a>
      </div>

      <div id="totalDisplay">
        T·ªïng m√≥n: 0 ƒë<br>
        Ph√≠ giao h√†ng: 0 ƒë<br>
        <strong>T·ªïng c·ªông: 0 ƒë</strong>
      </div>

      <button type="submit">G·ª≠i ƒë∆°n</button>
    </form>
  </div>

  <script>
    const products = {
      "TS Kem tr·ª©ng": 25000,
      "TS Kem tr·ª©ng M": 20000,
      "TS Kem cheese": 25000,
      "TS Kem cheese M": 20000,
      "TS B√°nh Flan": 25000,
      "TS B√°nh Flan M": 20000,
      "TS Oreo": 25000,
      "TS Oreo M": 20000,
      "TS Truy·ªÅn th·ªëng": 20000,
      "TS Truy·ªÅn th·ªëng M": 15000,
      "TS Th√°i xanh": 25000,
      "TS Th√°i xanh M": 20000,
      "TS Vi·ªát qu·∫•t": 20000,
      "TS Vi·ªát qu·∫•t M": 15000,
      "TS D√¢u": 20000,
      "TS D√¢u M": 15000,
      "TS B·∫°c h√†": 20000,
      "TS B·∫°c h√† M": 15000,
      "TS Than tre": 20000,
      "TS Than tre M": 15000,
      "TS Matcha": 20000,
      "TS Matcha M": 15000,
      "TS Khoai m√¥n": 25000,
      "TS Khoai m√¥n M": 20000,
      "TS Chu·ªëi": 20000,
      "TS Chu·ªëi M": 15000,
      "TS Tiramisu": 25000,
      "TS Tiramisu M": 20000,
      "TS G·∫°o rang": 25000,
      "TS G·∫°o rang M": 20000,
      "TS Full topping": 25000,
      "TS Chocola": 20000,
      "TS Chocola M": 15000,
      "TS Chocomint": 25000,
      "TS Chocomint M": 20000
    };

    const toppings = {
      "Topping b√°nh Flan": 8000,
      "Topping tr√¢n ch√¢u d·ª´a": 5000,
      "Topping h·∫°t ƒë√°c": 10000,
      "Topping rau cau ph√¥ mai": 5000,
      "Topping ch√¢n m√®o": 7000,
      "Topping khoai d·∫ªo": 6000,
      "Topping kh√∫c b·∫°ch": 6000,
      "Topping cheese ball": 5000,
      "Topping tr√¢n ch√¢u ƒëen": 5000,
      "Topping tr√¢n ch√¢u tr·∫Øng": 5000,
      "Topping h·∫°t ng·ªçc trai": 6000,
      "Topping kem tr·ª©ng": 6000,
      "Fulltopping th√™m": 10000,
      "Topping kem cheese": 6000,
      "Topping TC ƒëen": 5000,
      "topping c·ªß nƒÉng": 5000,
      "Topping c·ªß m√¥n": 5000
    };
    function addItem() {
      const container = document.getElementById("itemsContainer");
      const index = container.children.length;
      const block = document.createElement("div");
      block.className = "item-block";
      block.innerHTML = `
        <h4>M√≥n ${index + 1}</h4>
        <label>S·∫£n ph·∫©m:</label>
        <select name="product" onchange="calculateTotal()">
          ${Object.entries(products).map(([name, price]) => `<option value="${name}">${name} ‚Äì ${price.toLocaleString()} ƒë</option>`).join("")}
        </select>
        <label>S·ªë l∆∞·ª£ng:</label>
        <input type="number" name="quantity" value="1" min="1" onchange="calculateTotal()">
        <label>Topping:</label>
        <div class="topping-group">
          <button type="button" onclick="addTopping(this)">‚ûï Th√™m topping</button>
          <div class="topping-list"></div>
        </div>
        <label>Ghi ch√∫:</label>
        <textarea name="note" rows="2"></textarea>
        <button type="button" class="remove-btn" onclick="removeItem(this)">‚ùå X√≥a m√≥n</button>
      `;
      container.appendChild(block);
      calculateTotal();
    }

    function addTopping(button) {
      const toppingList = button.nextElementSibling;
      const select = document.createElement("select");
      select.innerHTML = `<option disabled selected>Ch·ªçn topping</option>` +
        Object.entries(toppings).map(([name, price]) =>
          `<option value="${name}">${name} ‚Äì ${price.toLocaleString()} ƒë</option>`
        ).join("");
      select.onchange = function () {
        const toppingName = this.value;
        const toppingPrice = toppings[toppingName];
        const toppingItem = document.createElement("div");
        toppingItem.innerHTML = `
          <span>${toppingName} (${toppingPrice.toLocaleString()} ƒë)</span>
          x <input type="number" value="1" min="1" onchange="calculateTotal()">
          <button type="button" onclick="this.parentElement.remove(); calculateTotal()">‚ùå</button>
        `;
        toppingList.appendChild(toppingItem);
        this.remove();
        calculateTotal();
      };
      toppingList.appendChild(select);
    }

    function removeItem(btn) {
      btn.parentElement.remove();
      calculateTotal();
    }

    function calculateTotal() {
      let totalItems = 0;
      const blocks = document.querySelectorAll(".item-block");
      blocks.forEach(block => {
        const product = block.querySelector('[name="product"]').value;
        const quantity = parseInt(block.querySelector('[name="quantity"]').value) || 1;

        let toppingTotal = 0;
        const toppingItems = block.querySelectorAll(".topping-list > div");
        toppingItems.forEach(item => {
          const name = item.querySelector("span").innerText.split(" (")[0];
          const qty = parseInt(item.querySelector("input").value) || 1;
          const price = toppings[name] || 0;
          toppingTotal += price * qty;
        });

        const productPrice = products[product] || 0;
        totalItems += (productPrice * quantity) + toppingTotal;
      });

      const method = document.getElementById("method").value;
      const deliveryFee = method === "Giao h√†ng t·∫≠n n∆°i" ? 5000 : 0;
      const total = totalItems + deliveryFee;

      const addressBlock = document.getElementById("addressBlock");
      const pickupLocation = document.getElementById("pickupLocation");
      if (method === "Nh·∫≠n t·∫°i qu√°n") {
        addressBlock.style.display = "none";
        pickupLocation.style.display = "block";
      } else {
        addressBlock.style.display = "block";
        pickupLocation.style.display = "none";
      }

      document.getElementById("totalDisplay").innerHTML = `
        T·ªïng m√≥n: ${totalItems.toLocaleString()} ƒë<br>
        Ph√≠ giao h√†ng: ${deliveryFee.toLocaleString()} ƒë<br>
        <strong>T·ªïng c·ªông: ${total.toLocaleString()} ƒë</strong>
      `;
    }

    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          const lat = position.coords.latitude.toFixed(6);
          const lon = position.coords.longitude.toFixed(6);
          const link = `https://www.google.com/maps?q=${lat},${lon}`;
          document.getElementById("address").value = `V·ªã tr√≠ hi·ªán t·∫°i: ${link}`;
        }, function(error) {
          alert("Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p.");
        });
      } else {
        alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã.");
      }
    }

    document.getElementById("orderForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const data = new FormData(e.target);
      const name = data.get("name");
      const phone = data.get("phone");
      const method = data.get("method");
      const address = data.get("address") || "Nh·∫≠n t·∫°i qu√°n";
      const blocks = document.querySelectorAll(".item-block");
      let message = `üßã ƒê∆°n m·ªõi t·ª´ kh√°ch:\nüë§ ${name}\nüì± ${phone}\nüöö H√¨nh th·ª©c: ${method}\nüìç ${address}\n\n`;

      blocks.forEach((block, i) => {
        const product = block.querySelector('[name="product"]').value;
        const quantity = block.querySelector('[name="quantity"]').value;
        const toppingItems = block.querySelectorAll(".topping-list > div");
        const toppingsList = Array.from(toppingItems).map(item => {
          const name = item.querySelector("span").innerText.split(" (")[0];
          const qty = item.querySelector("input").value;
          return `${name} x${qty}`;
        }).join(", ") || "Kh√¥ng";
        const note = block.querySelector('[name="note"]').value || "‚Äî";
        message += `ü•§ M√≥n ${i + 1}: ${product} x${quantity}\n‚ûï Topping: ${toppingsList}\nüìù Ghi ch√∫: ${note}\n\n`;
      });

      fetch("https://api.telegram.org/bot8430364195:AAHniNvZGsGvSnRiww8SE5H1eAgZLwW8CIE", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: "-4846885719",
          text: message
        })
      }).then(() => {
        alert("‚úÖ ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c g·ª≠i!");
        e.target.reset();
        document.getElementById("itemsContainer").innerHTML = "";
        document.getElementById("totalDisplay").innerHTML = `
          T·ªïng m√≥n: 0 ƒë<br>
          Ph√≠ giao h√†ng: 0 ƒë<br>
          <strong>T·ªïng c·ªông: 0 ƒë</strong>
        `;
        document.getElementById("pickupLocation").style.display = "none";
        document.getElementById("addressBlock").style.display = "block";
        addItem();
      }).catch(() => {
        alert("‚ùå G·ª≠i th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.");
      });
    });

    addItem();
  </script>
</body>
</html>
