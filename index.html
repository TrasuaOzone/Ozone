<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ozone Tea ‚Äì ƒê·∫∑t h√†ng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      background: #fff7f0;
      margin: 0;
      padding: 20px;
      transition: background 0.3s, color 0.3s;
    }
    body.dark-mode {
      background: #1e1e1e;
      color: #f0f0f0;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    body.dark-mode .container {
      background: #2c2c2c;
      box-shadow: none;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
    }
    .header img {
      height: 60px;
      border-radius: 12px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    .title-group h1 {
      font-size: 32px;
      font-weight: 600;
      margin: 0;
      color: #4b2e1e;
      font-family: 'Playfair Display', serif;
    }
    .title-group .subtitle {
      font-size: 16px;
      color: #888;
      margin-top: 4px;
      font-style: italic;
    }
    label {
      font-weight: bold;
      margin-top: 15px;
      display: block;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      background: #fff;
      color: #000;
    }
    body.dark-mode input,
    body.dark-mode select,
    body.dark-mode textarea {
      background: #333;
      color: #fff;
      border: 1px solid #555;
    }
    button {
      background: #d2691e;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      margin-top: 20px;
      cursor: pointer;
    }
    button:hover {
      background: #a0522d;
    }
    .item-block {
      border: 1px solid #ddd;
      padding: 15px;
      margin-top: 20px;
      border-radius: 8px;
      background: #f9f9f9;
    }
    body.dark-mode .item-block {
      background: #3a3a3a;
      border-color: #555;
    }
    .remove-btn {
      background: #c0392b;
      margin-top: 10px;
    }
    .topping-group {
      margin-top: 10px;
    }
    .topping-list div {
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .topping-list input {
      width: 60px;
    }
    #totalDisplay {
      font-size: 16px;
      font-weight: bold;
      margin-top: 30px;
      text-align: right;
      line-height: 1.6;
    }
    #darkModeToggle {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 999;
      padding: 8px 12px;
      font-size: 14px;
      background: #444;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <button id="darkModeToggle" onclick="toggleDarkMode()">üåô Ch·∫ø ƒë·ªô ban ƒë√™m</button>

  <div class="container">
    <div class="header">
      <img src="images/logo.png" alt="Ozone Tea Logo">
      <div class="title-group">
        <h1>Ozone Tea</h1>
        <p class="subtitle">ƒê·∫∑t h√†ng tr·ª±c tuy·∫øn</p>
      </div>
    </div>

    <form id="orderForm">
      <label>T√™n kh√°ch h√†ng:</label>
      <input type="text" name="name" required>

      <label>S·ªë ƒëi·ªán tho·∫°i:</label>
      <input type="tel" name="phone" required>

      <label>H√¨nh th·ª©c nh·∫≠n h√†ng:</label>
      <select name="method" id="method" onchange="calculateTotal()" required>
        <option value="Giao h√†ng t·∫≠n n∆°i">Giao h√†ng t·∫≠n n∆°i</option>
        <option value="Nh·∫≠n t·∫°i qu√°n">Nh·∫≠n t·∫°i qu√°n</option>
      </select>

      <label>Ph∆∞∆°ng th·ª©c thanh to√°n:</label>
      <select name="payment" id="payment" onchange="togglePaymentInfo()" required>
        <option value="COD">Thanh to√°n khi nh·∫≠n h√†ng</option>
        <option value="Bank">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</option>
      </select>

      <div id="itemsContainer"></div>
      <button type="button" onclick="addItem()">‚ûï Th√™m m√≥n</button>

      <div id="addressBlock">
        <label>ƒê·ªãa ch·ªâ giao h√†ng:</label>
        <textarea name="address" id="address" rows="3" required></textarea>
        <button type="button" onclick="getLocation()">üìç L·∫•y v·ªã tr√≠ hi·ªán t·∫°i</button>
      </div>

      <div id="pickupLocation" style="display:none; margin-top:10px;">
        üìç V·ªã tr√≠ qu√°n: <a href="https://maps.app.goo.gl/naLNEFFzdPMoCo586" target="_blank">Xem tr√™n Google Maps</a>
      </div>

      <div id="totalDisplay">
        T·ªïng m√≥n: 0 ƒë<br>
        Ph√≠ giao h√†ng: 0 ƒë<br>
        <strong>T·ªïng c·ªông: 0 ƒë</strong>
      </div>

      <button type="button" id="payBtn" onclick="handlePayment()" style="display:none;">üí≥ Thanh to√°n</button>
      <button type="submit" id="submitBtn">üì§ G·ª≠i ƒë∆°n</button>
    </form>
  </div>

<script>
  function toggleDarkMode() {
    const body = document.body;
    const toggleBtn = document.getElementById("darkModeToggle");
    body.classList.toggle("dark-mode");
    const isDark = body.classList.contains("dark-mode");
    localStorage.setItem("darkMode", isDark);
    toggleBtn.innerHTML = isDark ? "‚òÄÔ∏è Ch·∫ø ƒë·ªô ban ng√†y" : "üåô Ch·∫ø ƒë·ªô ban ƒë√™m";
  }

  if (localStorage.getItem("darkMode") === "true") {
    document.body.classList.add("dark-mode");
    document.getElementById("darkModeToggle").innerHTML = "‚òÄÔ∏è Ch·∫ø ƒë·ªô ban ng√†y";
  }

  function togglePaymentInfo() {
    const method = document.getElementById("payment").value;
    const payBtn = document.getElementById("payBtn");
    const submitBtn = document.getElementById("submitBtn");

    if (method === "Bank") {
      payBtn.style.display = "inline-block";
      submitBtn.style.display = "none";
    } else {
      payBtn.style.display = "none";
      submitBtn.style.display = "inline-block";
    }
  }

  function generateOrderCode() {
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    let code = '';
    for (let i = 0; i < 6; i++) {
      code += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    const timestamp = Date.now().toString().slice(-4);
    return `#OZ-${code}${timestamp}`;
  }

  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        const lat = position.coords.latitude.toFixed(6);
        const lon = position.coords.longitude.toFixed(6);
        const link = `https://www.google.com/maps?q=${lat},${lon}`;
        document.getElementById("address").value = `V·ªã tr√≠ hi·ªán t·∫°i: ${link}`;
      }, function(error) {
        alert("Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠. Vui l√≤ng ki·ªÉm tra quy·ªÅn truy c·∫≠p.");
      });
    } else {
      alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã.");
    }
  }
</script>
<script>
  // Th√™m m√≥n m·ªõi
  function addItem() {
    const container = document.getElementById("itemsContainer");
    const index = container.children.length;
    const block = document.createElement("div");
    block.className = "item-block";
    block.innerHTML = `
      <h4>M√≥n ${index + 1}</h4>
      <label>S·∫£n ph·∫©m:</label>
      <select name="product" onchange="calculateTotal()">
        ${Object.entries(products).map(([name, price]) => `<option value="${name}">${name} ‚Äì ${price.toLocaleString()} ƒë</option>`).join("")}
      </select>
      <label>S·ªë l∆∞·ª£ng:</label>
      <input type="number" name="quantity" value="1" min="1" onchange="calculateTotal()">
      <label>Topping:</label>
      <div class="topping-group">
        <button type="button" onclick="addTopping(this)">‚ûï Th√™m topping</button>
        <div class="topping-list"></div>
      </div>
      <label>Ghi ch√∫:</label>
      <textarea name="note" rows="2"></textarea>
      <button type="button" class="remove-btn" onclick="removeItem(this)">‚ùå X√≥a m√≥n</button>
    `;
    container.appendChild(block);
    calculateTotal();
  }

  // Th√™m topping
  function addTopping(button) {
    const toppingList = button.nextElementSibling;
    const select = document.createElement("select");
    select.innerHTML = `<option disabled selected>Ch·ªçn topping</option>` +
      Object.entries(toppings).map(([name, price]) =>
        `<option value="${name}">${name} ‚Äì ${price.toLocaleString()} ƒë</option>`
      ).join("");
    select.onchange = function () {
      const toppingName = this.value;
      const toppingPrice = toppings[toppingName];
      const toppingItem = document.createElement("div");
      toppingItem.innerHTML = `
        <span>${toppingName} (${toppingPrice.toLocaleString()} ƒë)</span>
        x <input type="number" value="1" min="1" onchange="calculateTotal()">
        <button type="button" onclick="this.parentElement.remove(); calculateTotal()">‚ùå</button>
      `;
      toppingList.appendChild(toppingItem);
      this.remove();
      calculateTotal();
    };
    toppingList.appendChild(select);
  }

  // X√≥a m√≥n
  function removeItem(btn) {
    btn.parentElement.remove();
    calculateTotal();
  }

  // T√≠nh t·ªïng ti·ªÅn
  function calculateTotal() {
    let totalItems = 0;
    const blocks = document.querySelectorAll(".item-block");
    blocks.forEach(block => {
      const product = block.querySelector('[name="product"]').value;
      const quantity = parseInt(block.querySelector('[name="quantity"]').value) || 1;

      let toppingTotal = 0;
      const toppingItems = block.querySelectorAll(".topping-list > div");
      toppingItems.forEach(item => {
        const name = item.querySelector("span").innerText.split(" (")[0];
        const qty = parseInt(item.querySelector("input").value) || 1;
        const price = toppings[name] || 0;
        toppingTotal += price * qty;
      });

      const productPrice = products[product] || 0;
      totalItems += (productPrice * quantity) + toppingTotal;
    });

    const method = document.getElementById("method").value;
    const deliveryFee = method === "Giao h√†ng t·∫≠n n∆°i" ? 5000 : 0;
    const total = totalItems + deliveryFee;

    const addressBlock = document.getElementById("addressBlock");
    const pickupLocation = document.getElementById("pickupLocation");
    if (method === "Nh·∫≠n t·∫°i qu√°n") {
      addressBlock.style.display = "none";
      pickupLocation.style.display = "block";
    } else {
      addressBlock.style.display = "block";
      pickupLocation.style.display = "none";
    }

    document.getElementById("totalDisplay").innerHTML = `
      T·ªïng m√≥n: ${totalItems.toLocaleString()} ƒë<br>
      Ph√≠ giao h√†ng: ${deliveryFee.toLocaleString()} ƒë<br>
      <strong>T·ªïng c·ªông: ${total.toLocaleString()} ƒë</strong>
    `;
  }

  // Danh s√°ch s·∫£n ph·∫©m
  const products = {
    "TS Kem tr·ª©ng": 25000,
    "TS Kem cheese": 25000,
    "TS B√°nh Flan": 25000,
    "TS Oreo": 25000,
    "TS Truy·ªÅn th·ªëng": 20000,
    "TS Th√°i xanh": 25000,
    "TS Vi·ªát qu·∫•t": 20000,
    "TS D√¢u": 20000,
    "TS B·∫°c h√†": 20000,
    "TS Than tre": 20000,
    "TS Matcha": 20000,
    "TS Khoai m√¥n": 25000,
    "TS Chu·ªëi": 20000,
    "TS Tiramisu": 25000,
    "TS G·∫°o rang": 25000,
    "TS Chocola": 20000,
    "TS Chocomint": 25000,
    "TS Full topping": 25000
  };

  // Danh s√°ch topping
  const toppings = {
    "Topping b√°nh Flan": 8000,
    "Topping tr√¢n ch√¢u d·ª´a": 5000,
    "Topping h·∫°t ƒë√°c": 10000,
    "Topping rau c√¢u ph√¥ mai": 5000,
    "Topping ch√¢n m√®o": 7000,
    "Topping khoai d·∫ªo": 6000,
    "Topping kh√∫c b·∫°ch": 6000,
    "Topping cheese ball": 5000,
    "Topping tr√¢n ch√¢u ƒëen": 5000,
    "Topping tr√¢n ch√¢u tr·∫Øng": 5000,
    "Topping h·∫°t ng·ªçc trai": 6000,
    "Topping kem tr·ª©ng": 6000,
    "Fulltopping th√™m": 10000,
    "Topping kem cheese": 6000,
    "Topping TC ƒëen": 5000,
    "Topping c·ªß nƒÉng": 5000,
    "Topping c·ªß m√¥n": 5000
  };
</script>
<script>
let orderId = "";

function handlePayment() {
  orderId = generateOrderCode();
  document.getElementById("submitBtn").click();
}

document.getElementById("orderForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const data = new FormData(e.target);
  const name = data.get("name");
  const phone = data.get("phone");
  const method = data.get("method");
  const payment = data.get("payment");
  const address = data.get("address") || "Nh·∫≠n t·∫°i qu√°n";
  const blocks = document.querySelectorAll(".item-block");

  if (!orderId) orderId = generateOrderCode();
  const now = new Date();
  const dateStr = now.toLocaleDateString('vi-VN');
  const timeStr = now.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });

  let message = `üßã ƒê∆°n m·ªõi t·ª´ kh√°ch:\nüë§ ${name}\nüì± ${phone}\nüöö H√¨nh th·ª©c: ${method}\nüí≥ Thanh to√°n: ${payment}\nüìç ${address}\n\n`;
  let totalItems = 0;
  let invoiceHTML = `
    <div id="invoice" style="max-width:700px; margin:60px auto; font-family:'Quicksand', sans-serif; border:1px solid #ccc; padding:30px; border-radius:12px;">
      <div style="text-align:center;">
        <img src="images/logo.png" alt="Ozone Tea Logo" style="height:60px;"><br>
        <h2 style="margin:10px 0; color:#4b2e1e;">H√ìA ƒê∆†N ƒê·∫∂T H√ÄNG</h2>
        <p style="color:#888;">M√£ ƒë∆°n h√†ng: <strong style="color:#d2691e;">${orderId}</strong></p>
        <p style="color:#555;">üïí Th·ªùi gian t·∫°o ƒë∆°n: <strong>${dateStr} l√∫c ${timeStr}</strong></p>
      </div>
      <hr style="margin:20px 0;">
      <p><strong>üë§ Kh√°ch h√†ng:</strong> ${name}</p>
      <p><strong>üì± S·ªë ƒëi·ªán tho·∫°i:</strong> ${phone}</p>
      <p><strong>üöö H√¨nh th·ª©c nh·∫≠n h√†ng:</strong> ${method}</p>
      <p><strong>üí≥ Thanh to√°n:</strong> ${payment}</p>
      <p><strong>üìç ƒê·ªãa ch·ªâ:</strong> ${address}</p>
      <hr style="margin:20px 0;">
      <h3 style="color:#4b2e1e;">üßã Danh s√°ch m√≥n</h3>
  `;

  blocks.forEach((block, i) => {
    const product = block.querySelector('[name="product"]').value;
    const quantity = parseInt(block.querySelector('[name="quantity"]').value) || 1;
    const productPrice = products[product] || 0;
    const toppingItems = block.querySelectorAll(".topping-list > div");

    let toppingHTML = "";
    let toppingText = "";
    let toppingTotal = 0;
    toppingItems.forEach(item => {
      const name = item.querySelector("span").innerText.split(" (")[0];
      const qty = parseInt(item.querySelector("input").value) || 1;
      const price = toppings[name] || 0;
      toppingTotal += price * qty;
      toppingHTML += `<li>${name} x${qty} ‚Äì ${price.toLocaleString()} ƒë</li>`;
      toppingText += `${name} x${qty}, `;
    });

    const note = block.querySelector('[name="note"]').value.trim();
    const showNote = note !== "";
    const showTopping = toppingHTML !== "";

    const itemTotal = (productPrice * quantity) + toppingTotal;
    totalItems += itemTotal;

    message += `ü•§ M√≥n ${i + 1}: ${product} x${quantity}\n`;
    if (showTopping) message += `‚ûï Topping: ${toppingText.slice(0, -2)}\n`;
    if (showNote) message += `üìù Ghi ch√∫: ${note}\n`;
    message += `üí∞ T·∫°m t√≠nh: ${itemTotal.toLocaleString()} ƒë\n\n`;

    invoiceHTML += `
      <div style="margin-bottom:20px;">
        <strong>${i + 1}. ${product}</strong> x${quantity} ‚Äì ${productPrice.toLocaleString()} ƒë<br>
        ${showNote ? `<em>Ghi ch√∫:</em> ${note}<br>` : ""}
        ${showTopping ? `<ul>${toppingHTML}</ul>` : ""}
        <p><strong>T·∫°m t√≠nh:</strong> ${itemTotal.toLocaleString()} ƒë</p>
      </div>
    `;
  });
  const deliveryFee = method === "Giao h√†ng t·∫≠n n∆°i" ? 5000 : 0;
  const total = totalItems + deliveryFee;

  message += `üöö Ph√≠ giao h√†ng: ${deliveryFee.toLocaleString()} ƒë\nüí∞ T·ªïng c·ªông: ${total.toLocaleString()} ƒë\nüîñ M√£ ƒë∆°n h√†ng: ${orderId}`;

  invoiceHTML += `
    <hr style="margin:20px 0;">
    <p><strong>Ph√≠ giao h√†ng:</strong> ${deliveryFee.toLocaleString()} ƒë</p>
    <h3 style="color:#d2691e;">T·ªïng c·ªông: ${total.toLocaleString()} ƒë</h3>
  `;

  if (payment === "Bank") {
    const bank = "bidv";
    const account = "7680087407";
    const nameAcc = "TR·∫¶N TH·ªä NG·ªåC TR√ÇM";
    const description = `Thanh toan ${orderId}`;
    const qrURL = `https://img.vietqr.io/image/${bank}-${account}-compact2.jpg?amount=${total}&addInfo=${encodeURIComponent(description)}&accountName=${encodeURIComponent(nameAcc)}`;

    invoiceHTML += `
      <div style="text-align:center; margin-top:30px;">
        <h3>üí≥ Qu√©t m√£ QR ƒë·ªÉ chuy·ªÉn kho·∫£n</h3>
        <img src="${qrURL}" alt="QR chuy·ªÉn kho·∫£n" style="width:240px; border-radius:12px; box-shadow:0 0 8px rgba(0,0,0,0.1); margin-bottom:10px;">
        <p style="font-size:14px; color:#555;">
          Ng√¢n h√†ng: BIDV<br>
          S·ªë t√†i kho·∫£n: <strong>${account}</strong><br>
          Ch·ªß t√†i kho·∫£n: <strong>${nameAcc}</strong><br>
          N·ªôi dung chuy·ªÉn kho·∫£n: <code>${description}</code>
        </p>
        <p style="font-size:13px; color:#888;">
          üëâ N·∫øu kh√¥ng m·ªü ƒë∆∞·ª£c ·ª©ng d·ª•ng ng√¢n h√†ng, h√£y d√πng <strong>Zalo</strong> ƒë·ªÉ qu√©t m√£ QR b√™n tr√™n.<br>
          üì∑ V√†o Zalo > Qu√©t m√£ > Chuy·ªÉn kho·∫£n nhanh ch√≥ng
        </p>

        <label style="margin-top:15px;">Ng√¢n h√†ng c·ªßa b·∫°n:</label>
        <select id="bankSelect" style="padding:8px; margin-top:6px; border-radius:6px;">
          <option value="bidv">BIDV ‚Äì Ng√¢n h√†ng ƒê·∫ßu t∆∞ & Ph√°t tri·ªÉn VN</option>
          <option value="vcb">Vietcombank ‚Äì Ngo·∫°i th∆∞∆°ng VN</option>
          <option value="vietinbank">VietinBank ‚Äì C√¥ng th∆∞∆°ng VN</option>
          <option value="agribank">Agribank ‚Äì N√¥ng nghi·ªáp & PTNT</option>
          <option value="mbbank">MBBank ‚Äì Qu√¢n ƒë·ªôi</option>
          <option value="techcombank">Techcombank ‚Äì K·ªπ th∆∞∆°ng VN</option>
          <option value="tpbank">TPBank ‚Äì Ti√™n Phong</option>
          <option value="vpbank">VPBank ‚Äì Vi·ªát Nam Th·ªãnh V∆∞·ª£ng</option>
          <option value="acb">ACB ‚Äì √Å Ch√¢u</option>
          <option value="sacombank">Sacombank ‚Äì S√†i G√≤n Th∆∞∆°ng T√≠n</option>
          <option value="vib">VIB ‚Äì Qu·ªëc t·∫ø VN</option>
          <option value="hdbank">HDBank ‚Äì Ph√°t tri·ªÉn TP.HCM</option>
          <option value="ocb">OCB ‚Äì Ph∆∞∆°ng ƒê√¥ng</option>
          <option value="shb">SHB ‚Äì S√†i G√≤n ‚Äì H√† N·ªôi</option>
          <option value="eximbank">Eximbank ‚Äì Xu·∫•t nh·∫≠p kh·∫©u VN</option>
          <option value="seabank">SeABank ‚Äì ƒê√¥ng Nam √Å</option>
          <option value="lienvietpostbank">LienVietPostBank ‚Äì B∆∞u ƒëi·ªán Li√™n Vi·ªát</option>
          <option value="bacabank">Bac A Bank ‚Äì B·∫Øc √Å</option>
          <option value="vietabank">VietABank ‚Äì Vi·ªát √Å</option>
          <option value="ncb">NCB ‚Äì Qu·ªëc D√¢n</option>
          <option value="vietbank">VietBank ‚Äì Vi·ªát Nam Th∆∞∆°ng T√≠n</option>
          <option value="pgbank">PGBank ‚Äì XƒÉng d·∫ßu Petrolimex</option>
          <option value="baovietbank">BAOVIET Bank ‚Äì B·∫£o Vi·ªát</option>
          <option value="co-opbank">Co-opBank ‚Äì H·ª£p t√°c x√£ VN</option>
          <option value="kienlongbank">KienlongBank ‚Äì Ki√™n Long</option>
          <option value="namabank">Nam A Bank ‚Äì Nam √Å</option>
          <option value="pvcombank">PVcomBank ‚Äì ƒê·∫°i ch√∫ng VN</option>
          <option value="scb">SCB ‚Äì S√†i G√≤n</option>
          <option value="uob">UOB ‚Äì United Overseas Bank</option>
          <option value="cimb">CIMB ‚Äì Malaysia</option>
          <option value="woori">Woori Bank ‚Äì H√†n Qu·ªëc</option>
          <option value="hsbc">HSBC ‚Äì Anh Qu·ªëc</option>
          <option value="standardchartered">Standard Chartered ‚Äì Anh Qu·ªëc</option>
          <option value="anz">ANZ ‚Äì √öc</option>
        </select>

        <button onclick="openBankApp()" style="margin-top:10px; padding:10px 20px; font-size:16px; background:#007bff; color:white; border:none; border-radius:6px; cursor:pointer;">
          üîó M·ªü trang VietQR ng√¢n h√†ng
        </button>

        <button onclick="confirmPayment()" style="margin-top:10px; padding:10px 20px; font-size:16px; background:#28a745; color:white; border:none; border-radius:6px; cursor:pointer;">
          ‚úÖ T√¥i ƒë√£ chuy·ªÉn kho·∫£n
        </button>
      </div>
    `;
  }
  invoiceHTML += `
    <hr style="margin:20px 0;">
    <p style="text-align:center; font-size:14px; color:#888;">C·∫£m ∆°n b·∫°n ƒë√£ ƒë·∫∑t h√†ng t·∫°i Ozone Tea. Ch√∫ng t√¥i s·∫Ω li√™n h·ªá ƒë·ªÉ x√°c nh·∫≠n ƒë∆°n h√†ng.</p>
    <div style="text-align:center;">
      <button onclick="location.reload()" style="margin-top:20px; padding:12px 24px; font-size:16px; background:#4b2e1e; color:white; border:none; border-radius:6px; cursor:pointer;">
        ƒê·∫∑t th√™m ƒë∆°n kh√°c
      </button>
      <button onclick="saveInvoiceImage()" style="margin-top:10px; padding:10px 20px; font-size:16px; background:#888; color:white; border:none; border-radius:6px; cursor:pointer;">
        üíæ L∆∞u h√≥a ƒë∆°n d·∫°ng ·∫£nh
      </button>
    </div>
  </div>
  `;

  document.body.innerHTML = invoiceHTML;

  fetch("https://api.telegram.org/bot8430364195:AAHniNvZGsGvSnRiww8SE5H1eAgZLwW8CIE/sendMessage", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: "-4846885719",
      text: message
    })
  });
});
</script>

<script>
// ‚úÖ G·ª≠i x√°c nh·∫≠n ƒë√£ chuy·ªÉn kho·∫£n v·ªÅ Telegram
function confirmPayment() {
  fetch("https://api.telegram.org/bot8430364195:AAHniNvZGsGvSnRiww8SE5H1eAgZLwW8CIE/sendMessage", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: "-4846885719",
      text: `‚úÖ Kh√°ch ƒë√£ x√°c nh·∫≠n chuy·ªÉn kho·∫£n cho ƒë∆°n h√†ng ${orderId}`
    })
  }).then(() => {
    alert("‚úÖ C·∫£m ∆°n b·∫°n! Ch√∫ng t√¥i s·∫Ω ki·ªÉm tra v√† x√°c nh·∫≠n ƒë∆°n h√†ng.");
  }).catch(() => {
    alert("‚ùå Kh√¥ng th·ªÉ g·ª≠i x√°c nh·∫≠n. Vui l√≤ng th·ª≠ l·∫°i.");
  });
}

// ‚úÖ L∆∞u h√≥a ƒë∆°n d∆∞·ªõi d·∫°ng ·∫£nh PNG
function saveInvoiceImage() {
  const invoice = document.getElementById("invoice");
  if (!invoice) {
    alert("Kh√¥ng t√¨m th·∫•y h√≥a ƒë∆°n ƒë·ªÉ l∆∞u.");
    return;
  }

  html2canvas(invoice).then(canvas => {
    const link = document.createElement("a");
    link.download = "hoa_don_ozone.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  }).catch(() => {
    alert("‚ùå Kh√¥ng th·ªÉ l∆∞u h√≥a ƒë∆°n. Vui l√≤ng th·ª≠ l·∫°i.");
  });
}

// ‚úÖ M·ªü trang VietQR trung gian ƒë·ªÉ kh√°ch ch·ªçn app ng√¢n h√†ng
function openBankApp() {
  const appCode = document.getElementById("bankSelect").value;
  if (!appCode) {
    alert("Vui l√≤ng ch·ªçn ng√¢n h√†ng c·ªßa b·∫°n tr∆∞·ªõc khi ti·∫øp t·ª•c.");
    return;
  }

  const totalText = document.getElementById("totalDisplay").innerText;
  const match = totalText.match(/T·ªïng c·ªông: ([\d\.]+) ƒë/);
  const amount = match ? match[1].replace(/\./g, "") : "0";

  const account = "7680087407";
  const name = "TRAN THI NGOC TRAM";
  const description = `Thanh toan ${orderId}`;

  const url = `https://vietqr.io/pay?amount=${amount}&account=${account}&addInfo=${encodeURIComponent(description)}&accountName=${encodeURIComponent(name)}&app=${appCode}`;

  window.location.href = url;
}
</script>
</body>
</html>
